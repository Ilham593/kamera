<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Golden Hour Camera ðŸŒ…</title>
<style>
  :root {
    --accent: #f97316;
    --bg: #000;
    --fg: #fff;
  }
  html,body {
    margin:0;
    padding:0;
    height:100%;
    background:var(--bg);
    color:var(--fg);
    font-family: system-ui, Arial, sans-serif;
  }
  body {
    display:flex;
    flex-direction:column;
  }
  .stage {
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    background:var(--bg);
    overflow:hidden;
    position:relative;
  }
  canvas {
    width:100%;
    height:auto;
    object-fit:contain;
    max-height:100%;
  }
  video {display:none;}
  .bar {
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    align-items:center;
    gap:10px;
    padding:12px;
    background:#0b0b0b;
    border-top:1px solid #222;
  }
  button {
    background:var(--accent);
    color:#fff;
    border:none;
    padding:12px 18px;
    border-radius:999px;
    font-weight:700;
    font-size:1rem;
    cursor:pointer;
    flex-shrink:0;
  }
  button:active {
    background:#fb923c;
    transform:scale(0.97);
  }
  .info {
    font-size:0.85rem;
    opacity:0.8;
    text-align:center;
  }
  @media (max-width: 600px) {
    button {
      width:100%;
      max-width:300px;
    }
    .info {font-size:0.75rem;}
  }
</style>
</head>
<body>
  <div class="stage">
    <canvas id="c"></canvas>
    <video id="v" autoplay playsinline></video>
  </div>
  <div class="bar">
    <button id="shot">ðŸ“¸ Jepret Golden Hour</button>
  </div>
  <div class="info">
    Warna otomatis hangat & lembut â€¢ Efek glow + tone golden hour â€¢ Rasio 2.39:1
  </div>

<script>
(async()=>{
  const v=document.getElementById('v'), c=document.getElementById('c');
  const ctx=c.getContext('2d',{willReadFrequently:true});
  const btn=document.getElementById('shot');

  // Akses kamera (prioritaskan kamera belakang)
  const stream=await navigator.mediaDevices.getUserMedia({
    video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}},audio:false
  });
  v.srcObject=stream; await v.play();

  // Efek golden hour
  function goldenHour(img){
    const d=img.data, w=img.width,h=img.height;
    let avg=0,count=0;
    for(let i=0;i<d.length;i+=24){avg+=0.2126*d[i]+0.7152*d[i+1]+0.0722*d[i+2];count++;}
    const gain=0.9/(avg/count/255);

    for(let y=0;y<h;y++){
      const grad=0.4+0.6*(1-y/h); // gradient hangat dari atas
      for(let x=0;x<w;x++){
        const i=(y*w+x)*4;
        let r=d[i]*gain,g=d[i+1]*gain,b=d[i+2]*gain;
        const L=0.2126*r+0.7152*g+0.0722*b;
        const glow=Math.pow(L/255,3)*180;
        r+=glow*0.4; g+=glow*0.3;
        // tone warm sunset
        r*=1.14+0.10*grad; g*=1.07+0.05*grad; b*=0.93;
        // soft contrast
        const f=1.05; r=f*(r-128)+128; g=f*(g-128)+128; b=f*(b-128)+128;
        d[i]=Math.min(255,Math.max(0,r));
        d[i+1]=Math.min(255,Math.max(0,g));
        d[i+2]=Math.min(255,Math.max(0,b));
      }
    }
    return img;
  }

  function loop(){
    const W=v.videoWidth,H=v.videoHeight;
    if(!W||!H) return requestAnimationFrame(loop);
    const containerRatio = c.clientWidth / c.clientHeight;
    const camRatio = W / H;
    let drawW, drawH;
    if(camRatio > containerRatio){ // crop horizontal
      drawH = H;
      drawW = H * containerRatio;
    }else{ // crop vertical
      drawW = W;
      drawH = W / containerRatio;
    }
    c.width = W; c.height = H;
    ctx.drawImage(v,0,0,W,H);
    let img = ctx.getImageData(0,0,W,H);
    img = goldenHour(img);
    ctx.putImageData(img,0,0);

    // letterbox cinematic
    const targetH = Math.round(W/2.39);
    const bar = Math.max(0,Math.round((H-targetH)/2));
    if(bar>0){ctx.fillStyle='black';ctx.fillRect(0,0,W,bar);ctx.fillRect(0,H-bar,W,bar);}
    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);

  btn.onclick=()=>{
    const W=c.width,H=c.height;
    const tgtH=Math.round(W/2.39);
    const bar=Math.round((H-tgtH)/2);
    const out=document.createElement('canvas');
    out.width=W; out.height=tgtH;
    const octx=out.getContext('2d');
    octx.drawImage(c,0,bar,W,tgtH,0,0,W,tgtH);
    out.toBlob(b=>{
      const a=document.createElement('a');
      a.href=URL.createObjectURL(b);
      a.download=`goldenhour_${Date.now()}.jpg`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(a.href);
    },'image/jpeg',0.92);
  };
})();
</script>
</body>
</html>
